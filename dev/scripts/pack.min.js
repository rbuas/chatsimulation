jsext=function(){return jsext={isNullOrUndefined:function(variable){return"undefined"==typeof variable||null===variable},getObjectValues:function(dataObject){if(dataObject){var dataArray=Object.keys(dataObject).map(function(k){return dataObject[k]});return dataArray}},serializeDictionary:function(obj,connector){if(obj){connector=connector||",";var builder=[];for(var i in obj)obj.hasOwnProperty(i)&&"function"!=typeof i&&builder.push(i+"="+obj[i]);return builder.join(connector)}},buildUrl:function(link,params,starter){var serializedParams="string"==typeof params?params:_querystring.stringify(params),url=link||"";return serializedParams&&(starter=starter||"?",url.indexOf(starter)<0?url+=starter+serializedParams:url=url.endsWith("&")?url+serializedParams:url+"&"+serializedParams),url},first:function(obj){for(var i in obj)if(obj.hasOwnProperty(i)&&"function"!=typeof i)return obj[i]},trim:function(text){return text&&text.replace(/^\s+|\s+$/g,"")},escape:function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},format:function(format,args){if(format){for(var i=0;i<args.length;i++){var replacement="{"+i+"}";format=format.replace(replacement,args[i])}return format}},unique:function(arr){for(var a=arr.concat(),i=0;i<a.length;++i)for(var j=i+1;j<a.length;++j)a[i]===a[j]&&a.splice(j--,1);return a},removeArray:function(arr,killer){for(var a=arr.concat(),i=0;i<killer.length;++i){var val=killer[i],index=a.indexOf(val);index>=0&&a.splice(index,1)}return a},tryParseDate:function(sDate){return sDate.constructor===Date?sDate:sDate.constructor===Array?new Date(sDate[0],sDate[1],sDate[2]):sDate.constructor===Number?new Date(sDate):sDate.constructor===String?new Date(sDate):"object"==typeof sDate?new Date(sDate.year,sDate.month,sDate.date):NaN},parseDate:function(sDate){var date=sDate?this.tryParseDate(sDate):new Date;return date.toISOString()},parseDateGMT:function(sDate){var date=sDate?this.tryParseDate(sDate):new Date;return date.toGMTString()},parseDateGMTAddDays:function(sDate,days){var date=sDate?this.tryParseDate(sDate):new Date;return days?(date.addDays(days),date.toGMTString()):date.toGMTString()},parseDateGMTAddHours:function(sDate,hours){var date=sDate?this.tryParseDate(sDate):new Date;return hours?(date.addHours(hours),date.toGMTString()):date.toGMTString()},parseDateDDMMYYY:function(sDate,separator){if(sDate){var dateParts=sDate.split(separator||"/");if(dateParts&&3==dateParts.length){var dateObj=new Date(dateParts[2],dateParts[1]-1,dateParts[0]);return dateObj}}},dateToString:function(date){if(date){var dd=date.getDate(),mm=date.getMonth()+1,yyyy=date.getFullYear();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm);var stringDate=dd+"/"+mm+"/"+yyyy;return stringDate}},compareDate:function(a,b){return isFinite(a=this.formatDate(a).valueOf())&&isFinite(b=this.formatDate(b).valueOf())?(a>b)-(a<b):NaN},inRangeDate:function(d,start,end){return isFinite(d=this.formatDate(d).valueOf())&&isFinite(start=this.formatDate(start).valueOf())&&isFinite(end=this.formatDate(end).valueOf())?start<=d&&d<=end:NaN},getMonthName:function(lang){var monthTab;switch(lang){case"fr":monthTab=["Janvier","Fevrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","Decembre"];break;case"en":default:monthTab=["January","February","March","April","May","June","July","August","September","October","November","December"]}return monthTab},getCurrentMonthName:function(lang){lang||(lang="en");var today=new Date,monthes=this.getMonthName(lang);return monthes[today.getMonth()]}},String.prototype.trim||(String.prototype.trim=function(){return jsext.trim(this)}),Function.prototype.extends||(Function.prototype.extends=function(ParentClass){ParentClass.constructor==Function?(this.prototype=new ParentClass,this.prototype.constructor=this,this.prototype.parent=ParentClass.prototype):(this.prototype=ParentClass,this.prototype.constructor=this,this.prototype.parent=ParentClass)}),String.prototype.format||(String.prototype.format=function(){return jsext.format(this,arguments)}),String.prototype.startsWith||(String.prototype.startsWith=function(searchString,position){return position=position||0,this.substr(position,searchString.length)===searchString}),RegExp.escape||(RegExp.escape=function(text){return jsext.escape(text)}),Array.prototype.unique||(Array.prototype.unique=function(){return jsext.unique(this)}),Array.prototype.removeArray||(Array.prototype.removeArray=function(killer){return jsext.removeArray(this,killer)}),Date.prototype.addHours||(Date.prototype.addHours=function(h){return this.setTime(this.getTime()+60*parseInt(h)*60*1e3),this}),Date.prototype.addDays||(Date.prototype.addDays=function(days){return this.setTime(this.getTime()+24*parseInt(days)*60*60*1e3),this}),Date.prototype.minusHours||(Date.prototype.minusHours=function(h){return this.setTime(this.getTime()-60*parseInt(h)*60*1e3),this}),Date.prototype.minusDays||(Date.prototype.minusDays=function(days){return this.setTime(this.getTime()-24*parseInt(days)*60*60*1e3),this}),jsext}(),ChatApp=function(angular){var chatapp=angular.module("ChatApp",["ngRoute","ngResource","ngCookies"]);return chatapp.config(["$routeProvider","$locationProvider",function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"components/chat/chatapp.html",controller:"ChatController",controllerAs:"cac"}).otherwise({redirectTo:"/"})}]),chatapp}(angular),ResourceService=function(angular,app){return app.service("ResourceService",["$rootScope","$http",function($rootScope,$http){var self=this,resources={},state={lang:"en",languages:["en","es","fr","pt"]};self.loadResLanguage=function(lang){lang=lang||state.lang||"en";var langfile="/resources/common-"+lang+".json";return resources[langfile]?resources[langfile]:void $http({method:"get",url:langfile,headers:{"Content-Type":"application/vnd.api+json"}}).then(function(response){response&&response.data?(resources[langfile]=response.data,state.common=resources[langfile],$rootScope.$broadcast("common",state.common)):console.log("ERROR_COMMUNICATION")})},self.changeLanguage=function(lang){!lang||state.languages.indexOf(lang)<0||(state.lang=lang,$rootScope.$broadcast("lang",lang),self.loadResLanguage())},self.text=function(key){return state.common&&state.common[key]||key}}])}(angular,ChatApp),UserService=function(angular,jsext,app){return app.service("UserService",["$rootScope","$http","$cookies","$window","$interval",function($rootScope,$http,$cookies,$window,$interval){var self=this,db=$cookies,state={loggedUser:"",users:[]};self.connect=function(){self.readUsersDB(),self.pulling=$interval(function(){return self.verifyUpdates()},2e3)},self.deconnect=function(){if(self.pulling&&$interval.cancel(self.pulling),state.loggedUser){self.readUsersDB();var userIndex=state.users.indexOf(state.loggedUser);userIndex<0||(state.users.splice(userIndex,1),self.writeUsersDB())}},self.readUsersDB=function(){state.users=db.getObject("ca-users")||[]},self.writeUsersDB=function(senddata){db.putObject("ca-users",state.users)},self.register=function(nickname){return jsext.trim(nickname)?state.loggedUser?"ERROR_HASUSER":state.loggedUser==nickname?"ERROR_USERTWICE":(self.readUsersDB(),state.users.indexOf(nickname)>=0?"ERROR_USERLOGGED":(state.loggedUser=nickname,state.users.push(nickname),self.writeUsersDB(),$rootScope.$broadcast("user",state.loggedUser),void $rootScope.$broadcast("users",state.users))):"ERROR_NICKNAME"},self.loggedUser=function(){return state.loggedUser},self.verifyUpdates=function(){var oldUserCount=state.users.length;self.readUsersDB();var userCount=state.users.length;oldUserCount!=userCount&&$rootScope.$broadcast("users",state.users)}}])}(angular,jsext,ChatApp),UserController=function(angular,app){return app.controller("UserController",["$scope","$http","$location","$interval","$window","UserService",function($scope,$http,$location,$interval,$window,UserService){var uc=$scope;uc.registerError="",uc.loggedUser=null,uc.register=function(){uc.registerError=UserService.register(uc.userNickname)},uc.updateUserState=function(loggedUser){uc.loggedUser=loggedUser},uc.updateUsers=function(e,users){uc.users=users},uc.$on("users",uc.updateUsers),uc.$on("user",uc.updateUserState),UserService.connect(),$window.addEventListener("beforeunload",function(){return UserService.deconnect()})}])}(angular,ChatApp),ChatService=function(angular,jsext,app){return app.service("ChatService",["$rootScope","$http","$cookies","$window","$interval","UserService",function($rootScope,$http,$cookies,$window,$interval,UserService){var self=this,db=$cookies,state={history:[]};self.connect=function(){self.readHistoryDB(),self.pulling=$interval(function(){return self.verifyUpdates()},2e3)},self.deconnect=function(){self.pulling&&$interval.cancel(self.pulling)},self.readHistoryDB=function(){state.history=db.getObject("ca-history")||[]},self.writeHistoryDB=function(senddata){db.putObject("ca-history",state.history)},self.sendMessage=function(message){var loggedUser=UserService.loggedUser();if(!loggedUser)return"ERROR_MESSAGEWITHOUTUSER";if(!jsext.trim(message))return"ERROR_INVALIDMESSAGE";var date=new Date,dateString=date.toISOString(),entry={s:loggedUser,d:dateString,m:message};self.readHistoryDB(),state.history.push(entry),self.writeHistoryDB(),$rootScope.$broadcast("history",state.history)},self.verifyUpdates=function(){self.readHistoryDB(),$rootScope.$broadcast("history",state.history)}}])}(angular,jsext,ChatApp),ChatController=function(angular,app){return app.controller("ChatController",["$scope","$http","$location","$interval","$window","ChatService","ResourceService",function($scope,$http,$location,$interval,$window,ChatService,ResourceService){var cac=$scope;cac.newMessage="",cac.messageError="",cac.status="WAITING",cac.history=[],cac.i=function(key){return ResourceService.text(key)},cac.changeLanguage=function(lang){lang&&ResourceService.changeLanguage(lang)},cac.updateLanguage=function(e,lang){cac.lang=lang},cac.updateCommon=function(e,common){cac.status=null!=common?"READY":"ERROR"},cac.ready=function(){return"READY"==cac.status},cac.updateState=function(){cac.updateHistory()},cac.sendMessage=function(){var error=ChatService.sendMessage(cac.newMessage);return error?void(cac.messageError=error):(cac.messageError="",void(cac.newMessage=""))},cac.updateHistory=function(e,history){var oldHistoryCount=cac.history.length,historyCount=history.length;oldHistoryCount!=historyCount&&(cac.history=Object.assign({},history))},cac.$on("lang",cac.updateLanguage),cac.$on("common",cac.updateCommon),cac.$on("history",cac.updateHistory),cac.$on("user",function(e,loggedUser){cac.loggedUser=loggedUser}),ResourceService.loadResLanguage(),ChatService.connect(),$window.addEventListener("beforeunload",function(){return ChatService.deconnect()})}])}(angular,ChatApp),ChatDisplayUsers=function(angular,app){return app.directive("chatDisplayUsers",function(){return{restrict:"AE",templateUrl:"/components/chat/displayusers.html",scope:!0}})}(angular,ChatApp);